openapi: 3.0.0
info:
  title: myIoT
  version: '1.0'
  description: ''
  contact: {}
  license:
    name: MasterIT technologies a.s.
servers:
  - url: 'https://develop.masterit.cz'
    description: develop
paths:
  /api/customer/email/exist:
    get:
      summary: Account Check Request
      operationId: get-api-customer-email-exist
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                OK - email existuje:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data: true
                OK - email neexistuje:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data: false
      description: |-
        Metoda zkontroluje existenci emailu pro danou aplikaci

        [API check email existantion for entered application]
      tags:
        - authorization
      parameters:
        - schema:
            type: string
          in: query
          name: email
          description: email u kterého zjišťujeme existenci
          required: true
        - schema:
            type: string
            example: myIoT
          in: query
          name: app
          description: 'aplikace pro kterou, zjištujeme existenci emailu'
          required: true
    parameters: []
  /api/login:
    post:
      summary: Login Request
      operationId: post-api-login
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                OK:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data:
                      access_token: token
                      token_type: bearer
                      expires_in: 604800
                      user:
                        note: ''
                        type: scc
                        birth: null
                        email: email@gmail.com
                        recID: 999
                        sccID: 1
                        config:
                          rights:
                            role: user
                            appList: []
                            appRole: []
                            groupID: _default
                            cityList: []
                            groupList: []
                            deviceList: []
                        gender: null
                        mobile: ''
                        userID: 93
                        lastName: Test
                        appUserID: -1
                        firstName: Test
                        userGroup: masterit
                        profession: null
                        sendInvoice: null
                        transportID: null
                        userType: 0
                        tokenID: xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx
                        userLogin: loginTest
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Chybné vstupní parametry:
                  value:
                    status: error
                    err_msg: Chybné vstupní parametry
                    err_code: -2000
                    data: null
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Uživatel nenalezen:
                  value:
                    status: error
                    err_msg: Uživatel nebyl nalezen
                    err_code: -3001
                    data: null
                Nesprávné heslo:
                  value:
                    status: error
                    err_msg: Uživatelské heslo není správné
                    err_code: -3002
                    data: null
                Uživatelský účet není ověřený:
                  value:
                    status: error
                    err_msg: Uživatelský účet není ověřený
                    err_code: -3003
                    data: null
      description: |-
        Provede přihlášení do SCC a získání tokenu

        [API provides signing in to SCC and token obtaining]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  description: 'typ přihlášení (scc, email, google, facebook)'
                  example: email
                password:
                  type: string
                  description: uživatelské heslo u facebooku a google nevyžadováno
                login:
                  type: string
                  description: login uživatele (v případě google a fb se zde posílá token)
                app:
                  type: string
                  description: aplikace ze které se přihlašuji
                  example: myIoT
              required:
                - type
                - password
                - login
                - app
            examples:
              SCC:
                value:
                  type: scc
                  login: loginTest
                  password: xxxxxxxxx
              Email:
                value:
                  type: email
                  login: email@gmail.com
                  password: xxxxxxxxxxx
                  app: myIoT
              Google:
                value:
                  login: longGoogle token
                  type: google
              facebook:
                value:
                  login: longFB token
                  type: facebook
        description: ''
      tags:
        - authorization
      parameters:
        - schema:
            type: string
            default: application/json
          in: header
          name: Content-Type
          required: true
  api/customer/register:
    post:
      summary: Create Account Request
      operationId: post-customer-register
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                OK:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data:
                      note: tests
                      type: scc
                      email: test@test.test
                      recID: 0
                      sccID: 1
                      config:
                        rights:
                          role: user
                          appList: []
                          groupID: _default
                          cityList: []
                          groupList: []
                          deviceList: []
                      mobile: ''
                      userID: 0
                      lastName: test
                      appUserID: -1
                      firstName: test
                      userGroup: common
                      userType: 0
                      tokenID: ''
                      userLogin: slTest
                      userApp: default
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Email je již používán:
                  value:
                    status: error
                    err_msg: Email je již používán
                    err_code: -3004
                    data: null
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Nedostatečné oprávnění:
                  value:
                    status: error
                    err_msg: Nedostatečné oprávnění
                    err_code: -4000
                    data: null
      description: |-
        Registrace customera

        [Customer signing up]
      parameters:
        - schema:
            type: string
            default: application/json
          in: header
          name: Content-type
          description: typ obsahu
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
            examples:
              Vytvoření uživatele:
                value:
                  application: myIoT
                  birth: '1982'
                  email: xxxx.xxxx@xxxx.com
                  gender: male
                  login: testxxxx
                  password: xxxx123
                  type: email
              Vytvoření na základě pozvánky:
                value:
                  application: myIoT
                  birth: '1982'
                  email: xxxx.xxxx@xxxx.com
                  gender: male
                  login: testxxxx
                  password: xxxx123
                  type: email
                  requestID: ID pozvánky
        description: ''
      tags:
        - customers
    parameters: []
  /api/recovery/password:
    post:
      summary: Password reset Request
      operationId: post-api-recovery-password
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                OK:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data:
                      mailExists: true
      description: |-
        Kontroluje zda existuje uživatel s tímto emailem, pokud ano přepošle mu na email odkaz pro změnu hesla a vrací true

        [API checks if a user with this email exists, if so, sends the password change link to the email and returns true]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: 'email, kam se má zaslat odkaz'
                customer:
                  type: boolean
                  description: true pokud je užvatel customer
                app:
                  type: string
                  description: aplikace u které chci měnit heslo k účtu
              required:
                - email
                - customer
                - app
            examples:
              SCC:
                value:
                  email: tst@test.cz
                  customer: true
                  app: myIoT
        description: ''
      tags:
        - password-recovery
      parameters:
        - schema:
            type: string
            default: application/json
          in: header
          name: Content-Type
          required: true
  api/customer/confirm/send:
    get:
      summary: Resend email verification Request
      operationId: get-customer-confirm-send
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                OK:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data: null
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Požadována data neexistují:
                  value:
                    status: error
                    err_msg: Požadována data neexistují
                    err_code: -2006
                    data: null
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Nedostatečné oprávnění:
                  value:
                    status: error
                    err_msg: Nedostatečné oprávnění
                    err_code: -4000
                    data: null
      description: |-
        Odešle potvrzovací email na zadanou emailovou adresu

        [Sends a confirmation email to the specified email address]
      parameters:
        - schema:
            type: string
          in: query
          name: email
          description: 'email uživatele, který se musí potvrdit'
        - schema:
            type: string
          in: query
          name: app
          description: aplikace ke které se email váže
      tags:
        - customers
    parameters: []
  /api/app/mob/myiot/channel/list:
    get:
      summary: 'Get Info channel list Request, Search Info channel Request'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                OK - all:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data:
                      - data:
                          url: 'https://www.dpo.cz'
                        icon: null
                        name: Dopravní podnik Ostrava a.s.
                        type: adm
                        cisID: 100
                        color: '#000000'
                        recID: 33918
                        sccID: 1
                        itemID: dpo
                        public: true
                        changed: '2018-12-05T14:07:38'
                        created: '2018-12-04T15:28:50'
                        groupID: _common
                        iconUrl: null
                        imageUrl: null
                        changedBy: -1
                        createdBy: -1
                        description: Městská hromadná doprava v Ostravě.
                      - data: {}
                        icon: null
                        name: Master IT
                        type: adm
                        cisID: 100
                        color: '#000000'
                        recID: 31344
                        sccID: 1
                        itemID: mitt
                        public: false
                        groupID: _default
                        iconUrl: null
                        imageUrl: null
                        description: ''
                        created: '2018-11-20T09:23:48'
                        createdBy: -1
                        changed: ''
                        changedBy: null
                      - data:
                          url: 'https://www.ostrava.cz'
                        icon: null
                        name: Město Ostrava
                        type: adm
                        cisID: 100
                        color: '#000000'
                        recID: 33919
                        sccID: 1
                        itemID: ostrava
                        public: true
                        changed: '2019-01-16T13:26:40'
                        created: '2018-12-04T15:28:50'
                        groupID: _common
                        iconUrl: null
                        imageUrl: null
                        changedBy: -1
                        createdBy: -1
                        description: 'Statutární, krajské a univerzitní město na severovýchodě České republiky v Moravskoslezském kraji'
                OK - name == dop...:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data:
                      - data:
                          url: 'https://www.dpo.cz'
                        icon: null
                        name: Dopravní podnik Ostrava a.s.
                        type: adm
                        cisID: 100
                        color: '#000000'
                        recID: 33918
                        sccID: 1
                        itemID: dpo
                        public: true
                        changed: '2018-12-05T14:07:38'
                        created: '2018-12-04T15:28:50'
                        groupID: _common
                        iconUrl: null
                        imageUrl: null
                        changedBy: -1
                        createdBy: -1
                        description: Městská hromadná doprava v Ostravě.
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Nedostatečné oprávnění:
                  value:
                    status: error
                    err_msg: Nedostatečné oprávnění
                    err_code: -4000
                    data: null
      operationId: get-api-app-mob-myiot-channel-list
      description: |-
        Metoda vrátí seznam info kanálů popř seznam jehož položky začínají na name

        [The method returns a list of info channels or a list whose items start with name in query params]
      parameters:
        - schema:
            type: string
          in: query
          name: name
          description: název kanálu (pro vyhledávání)
          required: true
        - schema:
            type: string
            default: cs
          in: query
          name: locale
          description: jazyková mutace
        - schema:
            type: integer
            default: 0
          in: query
          name: page
          description: stránka (počátek 0)
        - schema:
            type: integer
            default: 10
          in: query
          name: limit
          description: počet položek na stránku
      security:
        - Bearer token: []
      tags:
        - application-myIoT
  api/customer/update:
    post:
      summary: UpdateCustomer Request (Set info-channel)
      operationId: post-customer-update
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                OK:
                  value:
                    status: ok
                    err_msg: ''
                    err_code: 0
                    data:
                      recID: 103
                      userID: 93
                      birth: 1994
                      gender: male
                      profession: technician
                      transportID: ''
                      mobile: '123456789'
                      email: xxxxx.xxxxx@xxxxx.com
                      defaultLang: null
                      sendInvoice: null
                      deviceList: []
                      infoChannels:
                        - dpo
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResult'
              examples:
                Nedostatečné oprávnění:
                  value:
                    status: error
                    err_msg: Nedostatečné oprávnění
                    err_code: -4000
                    data: null
      description: |-
        Metoda uloží parametry customera do databaze, je povoleno pouze uložit vlastní parametry, uživatel je identifikován tokenem

        [The method stores the customer's parameters in the database, it is only allowed to save the custom parameters, the user is identified by a token]
      security:
        - Bearer token: []
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
            examples:
              Update customera:
                value:
                  birth: 1994
                  email: xxxxx.xxxx@xxx.com
                  gender: male
                  mobile: '123456789'
                  profession: technician
                  recID: 0
                  transportID: ''
                  config:
                    infoChannels:
                      - dpo
        description: ''
      tags:
        - customers
    parameters: []
components:
  schemas:
    APIResult:
      title: APIResult
      type: object
      properties:
        status:
          type: string
        err_msg:
          type: string
        err_code:
          type: integer
        data:
          type:
            - 'null'
            - object
      x-examples:
        OK:
          status: ok
          err_msg: ''
          err_code: 0
          data: null
        ERROR:
          status: error
          err_msg: Nedostatečné oprávnění
          err_code: -4000
          data: null
  securitySchemes:
    Bearer token:
      type: http
      scheme: bearer
